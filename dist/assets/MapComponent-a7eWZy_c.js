import{j as e}from"./index-D1xeHa3J.js";import{r as n}from"./vendor-CRKWNzqH.js";import"./supabase-dOUp6-66.js";import"./ui-libs-K9mZ2qrl.js";let s;function r({data:r,selectedLocation:i,isSubscribed:t,userLocation:a,onPremiumClick:o}){const l=n.useRef(null),c=n.useRef(null),d=n.useRef(null),u=n.useRef(null),p=n.useRef(null),[m,v]=n.useState(null),f={street:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},satellite:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri"}},h=n.useCallback((e=>{let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>e.apply(null,s),150)}})(e=>{c.current&&m&&c.current.removeLayer(m);const n=s.tileLayer(f[e].url,{attribution:f[e].attribution,noWrap:!0}).addTo(c.current);v(n)}),[m]);n.useEffect(()=>{(async()=>{if(await(async()=>{var e;if("undefined"!=typeof window){if(["https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css","https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"].forEach(e=>{try{if(!document.querySelector(`link[href="${e}"]`)){const n=document.createElement("link");n.rel="stylesheet",n.href=e,document.head&&document.head.appendChild(n)}}catch(n){}}),!window.L)try{await new Promise((e,n)=>{const s=document.createElement("script");s.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",s.onload=e,s.onerror=n,document.head?document.head.appendChild(s):n(new Error("Document head not available"))})}catch(n){return}if(!(null==(e=window.L)?void 0:e.markerClusterGroup))try{await new Promise((e,n)=>{const s=document.createElement("script");s.src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js",s.onload=e,s.onerror=n,document.head?document.head.appendChild(s):n(new Error("Document head not available"))})}catch(n){return}s=window.L,s.markerClusterGroup}})(),l.current&&!c.current&&s&&a){const n=(null==a?void 0:a.lat)||41.01,i=(null==a?void 0:a.lng)||28.97;try{c.current=s.map(l.current,{maxBounds:[[-90,-180],[90,180]],maxBoundsViscosity:1,minZoom:2,maxZoom:18}).setView([n,i],10);const e=s.tileLayer(f.street.url,{attribution:f.street.attribution,noWrap:!0,bounds:[[-90,-180],[90,180]]}).addTo(c.current);v(e),u.current=s.circle([n,i],{radius:5e4,color:"#3b82f6",fillColor:"#60a5fa",fillOpacity:.1,weight:1}).addTo(c.current),c.current&&c.current.fitBounds(u.current.getBounds()),d.current=s.markerClusterGroup({maxClusterRadius:50,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0}),c.current.addLayer(d.current),c.current.on("zoomend moveend",()=>{setTimeout(()=>{d.current&&d.current.refreshClusters()},100)});const t=()=>{setTimeout(()=>{c.current&&d.current&&(c.current.invalidateSize(),d.current.refreshClusters(),0===d.current.getLayers().length&&r&&r.length>0&&setTimeout(()=>window.dispatchEvent(new CustomEvent("force-marker-refresh")),200))},150)};return window.addEventListener("resize",t),setTimeout(()=>{c.current&&c.current.invalidateSize()},100),()=>{window.removeEventListener("resize",t)}}catch(e){l.current&&(l.current.innerHTML="")}}})()},[a]),n.useEffect(()=>{if(c.current&&a){const e=s.divIcon({html:'<i class="fa-solid fa-location-pin user-location-icon"></i>',className:"",iconSize:[32,32],iconAnchor:[16,32]});u.current&&u.current.setLatLng([(null==a?void 0:a.lat)||41.01,(null==a?void 0:a.lng)||28.97]),p.current?p.current.setLatLng([(null==a?void 0:a.lat)||41.01,(null==a?void 0:a.lng)||28.97]):p.current=s.marker([(null==a?void 0:a.lat)||41.01,(null==a?void 0:a.lng)||28.97],{icon:e,zIndexOffset:1e3}).addTo(c.current)}},[a]);const[y,g]=n.useState(0);return n.useEffect(()=>{const e=()=>g(e=>e+1);return window.addEventListener("force-marker-refresh",e),()=>window.removeEventListener("force-marker-refresh",e)},[]),n.useEffect(()=>{d.current&&r.length&&a&&(c.current&&(c.current.removeLayer(d.current),d.current=s.markerClusterGroup({maxClusterRadius:50,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0}),c.current.addLayer(d.current)),r.forEach((e,n)=>{const r="job"===e.type?"fa-briefcase":"fa-user",i="job"===e.type?"#0097A7":"#FB8C00",t=`<div class="marker-container ${e.isSponsored?"sponsored-marker":""}">\n                <div class="icon-wrapper" style="border-color: ${e.isSponsored?"#FBBF24":i};">\n                    ${e.isSponsored?'<i class="fa-solid fa-star absolute -top-2 -right-2 text-yellow-400 text-xl"></i>':""}\n                    <i class="fa-solid ${r}" style="color: ${i};"></i>\n                </div>\n                <div class="marker-label">${e.title}</div>\n            </div>`,a=s.divIcon({html:t,className:"",iconSize:[120,90],iconAnchor:[60,26]}),l=s.marker([e.location.lat,e.location.lng],{icon:a}),c=function(e){return"adzuna"===e.source||e.adzuna_id||e.url&&e.url.includes("adzuna")||e.company&&e.salary_min&&e.salary_max&&e.url?function(e){var n,s,r;const i=e.city||"";return`\n    <div class="custom-popup-container adzuna-popup">\n      <div class="popup-header">\n        <div class="popup-title">${e.title}</div>\n        <div class="popup-source">\n          <i class="fa-solid fa-globe"></i>\n          Adzuna\n        </div>\n      </div>\n      \n      ${e.salary_min&&e.salary_max?`\n        <div class="popup-salary adzuna-salary">\n          <i class="fa-solid fa-dollar-sign"></i>\n          ${e.currency||"USD"} ${(null==(n=Math.round(e.salary_min))?void 0:n.toLocaleString())||"?"} - ${(null==(s=Math.round(e.salary_max))?void 0:s.toLocaleString())||"?"}\n        </div>\n      `:""}\n      \n      <div class="popup-details">\n        <div class="popup-company">\n          <i class="fa-solid fa-building"></i>\n          ${e.company||"Şirket bilgisi mevcut değil"}\n        </div>\n        <div class="popup-location">\n          <i class="fa-solid fa-location-dot"></i>\n          ${i}\n        </div>\n      </div>\n\n      ${(null==(r=e.description)?void 0:r.text)?`\n      <div class="popup-description">\n        ${e.description.text.substring(0,150)}...\n      </div>\n      `:""}\n      \n      ${e.url?`\n        <a href="${e.url}" target="_blank" rel="noopener noreferrer" class="popup-apply-btn adzuna-apply">\n          <i class="fa-solid fa-external-link"></i>\n          İlana Başvur\n        </a>\n      `:""}\n      \n      <div class="popup-footer">\n        <small>Powered by Adzuna API</small>\n      </div>\n    </div>\n  `}(e):"cv"===e.type?function(e){var n,s;const r=e.city||"";return`\n    <div class="custom-popup-container cv-popup">\n      <div class="popup-header">\n        <div class="popup-title">${e.title||"Profesyonel Profil"}</div>\n        <div class="popup-source cv-source">\n          <i class="fa-solid fa-user"></i>\n          Aday Profili\n        </div>\n      </div>\n      \n      <div class="popup-candidate">\n        <div class="candidate-name">\n          <i class="fa-solid fa-user-tie"></i>\n          ${e.name||e.full_name||"İsim belirtilmemiş"}\n        </div>\n      </div>\n      \n      ${e.salary_min&&e.salary_max?`\n        <div class="popup-salary cv-salary">\n          <i class="fa-solid fa-chart-line"></i>\n          Beklenti: ${e.currency||"TRY"} ${(null==(n=Math.round(e.salary_min))?void 0:n.toLocaleString())||"?"} - ${(null==(s=Math.round(e.salary_max))?void 0:s.toLocaleString())||"?"}\n        </div>\n      `:""}\n      \n      <div class="popup-details">\n        ${e.experience_years?`\n          <div class="popup-experience">\n            <i class="fa-solid fa-calendar-days"></i>\n            ${e.experience_years} yıl deneyim\n          </div>\n        `:""}\n        <div class="popup-location">\n          <i class="fa-solid fa-location-dot"></i>\n          ${r}\n        </div>\n        ${e.remote?'\n          <div class="popup-remote">\n            <i class="fa-solid fa-wifi"></i>\n            Uzaktan çalışmaya açık\n          </div>\n        ':""}\n      </div>\n      \n      ${e.skills?`\n        <div class="popup-skills">\n          <div class="skills-label">\n            <i class="fa-solid fa-code"></i>\n            Yetenekler\n          </div>\n          <div class="skills-list">${e.skills.split(",").slice(0,3).join(", ")}${e.skills.split(",").length>3?"...":""}</div>\n        </div>\n      `:""}\n      \n      ${e.contact?`\n        <div class="popup-contact cv-contact">\n          <div class="contact-label">\n            <i class="fa-solid fa-envelope"></i>\n            İletişim\n          </div>\n          <div class="contact-info">${e.contact}</div>\n        </div>\n      `:""}\n      \n      <div class="popup-footer">\n        <small>Aday Profili • Teppek</small>\n      </div>\n    </div>\n  `}(e):function(e){var n,s,r;const i=e.city||"";return`\n    <div class="custom-popup-container manual-job-popup">\n      <div class="popup-header">\n        <div class="popup-title">${e.title}</div>\n        <div class="popup-source manual-source">\n          <i class="fa-solid fa-user-plus"></i>\n          Manuel İlan\n        </div>\n      </div>\n      \n      ${e.salary_min&&e.salary_max?`\n        <div class="popup-salary manual-salary">\n          <i class="fa-solid fa-money-bill-wave"></i>\n          ${e.currency||"TRY"} ${(null==(n=Math.round(e.salary_min))?void 0:n.toLocaleString())||"?"} - ${(null==(s=Math.round(e.salary_max))?void 0:s.toLocaleString())||"?"}\n        </div>\n      `:""}\n      \n      <div class="popup-details">\n        <div class="popup-company">\n          <i class="fa-solid fa-building"></i>\n          ${e.company||"Şirket bilgisi mevcut değil"}\n        </div>\n        <div class="popup-location">\n          <i class="fa-solid fa-location-dot"></i>\n          ${i}\n        </div>\n      </div>\n\n      ${(null==(r=e.description)?void 0:r.text)?`\n      <div class="popup-description">\n        ${e.description.text.substring(0,150)}...\n      </div>\n      `:""}\n      \n      ${e.contact?`\n        <div class="popup-contact manual-contact">\n          <div class="contact-label">\n            <i class="fa-solid fa-envelope"></i>\n            İletişim Bilgileri\n          </div>\n          <div class="contact-info">${e.contact}</div>\n        </div>\n      `:""}\n      \n      <div class="popup-footer">\n        <small>Yerel İlan • Teppek</small>\n      </div>\n    </div>\n  `}(e)}(e);window.handlePremiumClick=o,l.bindPopup(c),d.current.addLayer(l)}))},[r,t,y]),n.useEffect(()=>{i&&c.current&&c.current.setView([i.lat,i.lng],16)},[i]),e.jsxDEV("div",{className:"relative h-full w-full",children:[e.jsxDEV("div",{ref:l,className:"h-full w-full",style:{zIndex:1}},void 0,!1,{fileName:"C:/Users/seher/Desktop/geoo/src/components/MapComponent.jsx",lineNumber:320,columnNumber:13},this),e.jsxDEV("div",{className:"absolute bottom-4 left-4 z-[1000] flex flex-col gap-2",children:[e.jsxDEV("button",{onClick:()=>c.current&&a&&c.current.setView([(null==a?void 0:a.lat)||41.01,(null==a?void 0:a.lng)||28.97],14),className:"bg-green-600 text-white font-semibold px-4 py-2 rounded-lg shadow-lg hover:bg-green-700 transition-colors",children:"Konum"},void 0,!1,{fileName:"C:/Users/seher/Desktop/geoo/src/components/MapComponent.jsx",lineNumber:323,columnNumber:17},this),e.jsxDEV("div",{className:"bg-white rounded-lg shadow-lg flex",children:[e.jsxDEV("button",{onClick:()=>h("street"),className:"px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-l-lg transition-colors",children:"Sokak"},void 0,!1,{fileName:"C:/Users/seher/Desktop/geoo/src/components/MapComponent.jsx",lineNumber:330,columnNumber:22},this),e.jsxDEV("button",{onClick:()=>h("satellite"),className:"px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-r-lg border-l transition-colors",children:"Uydu"},void 0,!1,{fileName:"C:/Users/seher/Desktop/geoo/src/components/MapComponent.jsx",lineNumber:331,columnNumber:22},this)]},void 0,!0,{fileName:"C:/Users/seher/Desktop/geoo/src/components/MapComponent.jsx",lineNumber:329,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/seher/Desktop/geoo/src/components/MapComponent.jsx",lineNumber:322,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/seher/Desktop/geoo/src/components/MapComponent.jsx",lineNumber:319,columnNumber:9},this)}export{r as default};
