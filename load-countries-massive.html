<!DOCTYPE html>
<html>
<head>
    <title>Teppek - Ã‡oklu Ãœlke Veri YÃ¼kleme</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        h1 { color: #333; }
        .controls { margin: 20px 0; padding: 15px; background: #e9ecef; border-radius: 5px; }
        .country-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px; margin: 20px 0; }
        .country-card { padding: 15px; border: 2px solid #ddd; border-radius: 5px; background: white; }
        .country-card.loading { background: #fff3cd; border-color: #ffc107; }
        .country-card.success { background: #d4edda; border-color: #28a745; }
        .country-card.error { background: #f8d7da; border-color: #dc3545; }
        .stats { margin-top: 20px; padding: 15px; background: #17a2b8; color: white; border-radius: 5px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .progress { margin: 10px 0; }
        .progress-bar { height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: #28a745; transition: width 0.3s; }
        #log { max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ Teppek Ã‡oklu Ãœlke Veri YÃ¼kleme Sistemi</h1>
        
        <div class="stats">
            <h3>ğŸ“Š Genel Durum</h3>
            <p>Toplam YÃ¼klenen: <strong id="totalListings">0</strong> ilan</p>
            <p>Ä°ÅŸlenen Ãœlke: <strong id="processedCountries">0</strong> / <strong id="totalCountries">0</strong></p>
            <p>API Ã‡aÄŸrÄ±sÄ±: <strong id="apiCalls">0</strong></p>
            <p>Durum: <span id="status">HazÄ±r</span></p>
            <div class="progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button id="startAllBtn" onclick="startLoadingAll()">ğŸš€ TÃ¼m Ãœlkelerden Veri YÃ¼kle</button>
            <button id="startSelectedBtn" onclick="startLoadingSelected()">ğŸ“ SeÃ§ili Ãœlkelerden YÃ¼kle</button>
            <button id="stopBtn" onclick="stopLoading()" disabled>â¹ï¸ Durdur</button>
            <button onclick="clearLog()">ğŸ—‘ï¸ Logu Temizle</button>
        </div>
        
        <h3>Ãœlkeler:</h3>
        <div class="country-grid" id="countries"></div>
        
        <h3>ğŸ“‹ Ä°ÅŸlem Logu:</h3>
        <div id="log"></div>
    </div>

    <script>
        const countries = [
            { code: 'gb', name: 'ğŸ‡¬ğŸ‡§ Ä°ngiltere', selected: true },
            { code: 'us', name: 'ğŸ‡ºğŸ‡¸ Amerika', selected: true },
            { code: 'de', name: 'ğŸ‡©ğŸ‡ª Almanya', selected: true },
            { code: 'fr', name: 'ğŸ‡«ğŸ‡· Fransa', selected: true },
            { code: 'ca', name: 'ğŸ‡¨ğŸ‡¦ Kanada', selected: true },
            { code: 'au', name: 'ğŸ‡¦ğŸ‡º Avustralya', selected: true },
            { code: 'nl', name: 'ğŸ‡³ğŸ‡± Hollanda', selected: false },
            { code: 'it', name: 'ğŸ‡®ğŸ‡¹ Ä°talya', selected: false },
            { code: 'es', name: 'ğŸ‡ªğŸ‡¸ Ä°spanya', selected: false },
            { code: 'sg', name: 'ğŸ‡¸ğŸ‡¬ Singapur', selected: false },
            { code: 'nz', name: 'ğŸ‡³ğŸ‡¿ Yeni Zelanda', selected: false },
            { code: 'za', name: 'ğŸ‡¿ğŸ‡¦ GÃ¼ney Afrika', selected: false },
            { code: 'at', name: 'ğŸ‡¦ğŸ‡¹ Avusturya', selected: false },
            { code: 'br', name: 'ğŸ‡§ğŸ‡· Brezilya', selected: false },
            { code: 'mx', name: 'ğŸ‡²ğŸ‡½ Meksika', selected: false },
            { code: 'in', name: 'ğŸ‡®ğŸ‡³ Hindistan', selected: false },
            { code: 'pl', name: 'ğŸ‡µğŸ‡± Polonya', selected: false },
            { code: 'be', name: 'ğŸ‡§ğŸ‡ª BelÃ§ika', selected: false },
            { code: 'ch', name: 'ğŸ‡¨ğŸ‡­ Ä°sviÃ§re', selected: false },
            { code: 'ru', name: 'ğŸ‡·ğŸ‡º Rusya', selected: false }
        ];
        
        let totalListings = 0;
        let processedCountries = 0;
        let apiCalls = 0;
        let isRunning = false;
        
        // Ãœlke listesini oluÅŸtur
        function createCountryCards() {
            const container = document.getElementById('countries');
            container.innerHTML = '';
            
            countries.forEach(country => {
                const card = document.createElement('div');
                card.className = 'country-card';
                card.id = `country-${country.code}`;
                card.innerHTML = `
                    <label>
                        <input type="checkbox" id="check-${country.code}" ${country.selected ? 'checked' : ''}>
                        <strong>${country.name}</strong>
                    </label>
                    <div id="${country.code}-status">Bekliyor...</div>
                    <div id="${country.code}-count">0 ilan</div>
                `;
                container.appendChild(card);
            });
            
            document.getElementById('totalCountries').textContent = countries.length;
        }
        
        // Log ekle
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#333';
            logDiv.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Logu temizle
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // Ä°lerleme barÄ±nÄ± gÃ¼ncelle
        function updateProgress() {
            const progress = (processedCountries / countries.filter(c => 
                document.getElementById(`check-${c.code}`).checked
            ).length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }
        
        // Tek Ã¼lkeden veri yÃ¼kle
        async function loadCountryData(country, page = 1, maxPages = 5) {
            const card = document.getElementById(`country-${country.code}`);
            card.className = 'country-card loading';
            
            let totalFetched = 0;
            addLog(`ğŸŒ ${country.name} yÃ¼kleniyor...`);
            
            for (let p = 1; p <= maxPages && isRunning; p++) {
                try {
                    const response = await fetch(
                        `https://teppek.com/api/adzuna-massive-simple?country=${country.code}&page=${p}`
                    );
                    
                    apiCalls++;
                    document.getElementById('apiCalls').textContent = apiCalls;
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.success && result.listings) {
                        const fetched = result.listings.length;
                        totalFetched += fetched;
                        totalListings += fetched;
                        
                        document.getElementById(`${country.code}-count`).textContent = `${totalFetched} ilan`;
                        document.getElementById('totalListings').textContent = totalListings.toLocaleString();
                        
                        if (fetched === 0) break; // Daha fazla veri yok
                    } else {
                        throw new Error(result.error || 'Bilinmeyen hata');
                    }
                    
                    // Rate limiting iÃ§in bekle
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                } catch (error) {
                    addLog(`âŒ ${country.name} Sayfa ${p} hatasÄ±: ${error.message}`, 'error');
                    break;
                }
            }
            
            if (totalFetched > 0) {
                card.className = 'country-card success';
                document.getElementById(`${country.code}-status`).textContent = `âœ… TamamlandÄ±`;
                addLog(`âœ… ${country.name}: ${totalFetched} ilan yÃ¼klendi`, 'success');
            } else {
                card.className = 'country-card error';
                document.getElementById(`${country.code}-status`).textContent = `âŒ Hata`;
            }
            
            processedCountries++;
            document.getElementById('processedCountries').textContent = processedCountries;
            updateProgress();
        }
        
        // TÃ¼m Ã¼lkelerden yÃ¼kleme baÅŸlat
        async function startLoadingAll() {
            countries.forEach(c => {
                document.getElementById(`check-${c.code}`).checked = true;
            });
            startLoading();
        }
        
        // SeÃ§ili Ã¼lkelerden yÃ¼kleme baÅŸlat
        async function startLoadingSelected() {
            startLoading();
        }
        
        // YÃ¼kleme baÅŸlat
        async function startLoading() {
            if (isRunning) return;
            
            isRunning = true;
            totalListings = 0;
            processedCountries = 0;
            apiCalls = 0;
            
            document.getElementById('startAllBtn').disabled = true;
            document.getElementById('startSelectedBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('status').textContent = 'â³ YÃ¼kleniyor...';
            
            clearLog();
            addLog('ğŸš€ Veri yÃ¼kleme baÅŸlatÄ±ldÄ±');
            
            const selectedCountries = countries.filter(c => 
                document.getElementById(`check-${c.code}`).checked
            );
            
            if (selectedCountries.length === 0) {
                addLog('âš ï¸ LÃ¼tfen en az bir Ã¼lke seÃ§in', 'error');
                stopLoading();
                return;
            }
            
            // Her Ã¼lkeyi sÄ±rayla yÃ¼kle
            for (const country of selectedCountries) {
                if (!isRunning) break;
                
                await loadCountryData(country);
                
                // Ãœlkeler arasÄ± bekleme
                if (selectedCountries.indexOf(country) < selectedCountries.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            document.getElementById('status').textContent = 'âœ… TamamlandÄ±!';
            addLog(`ğŸ‰ Toplam ${totalListings} ilan yÃ¼klendi`, 'success');
            stopLoading();
        }
        
        // YÃ¼klemeyi durdur
        function stopLoading() {
            isRunning = false;
            document.getElementById('startAllBtn').disabled = false;
            document.getElementById('startSelectedBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
        
        // Sayfa yÃ¼klendiÄŸinde
        createCountryCards();
        addLog('Sistem hazÄ±r. YÃ¼klemek istediÄŸiniz Ã¼lkeleri seÃ§in ve baÅŸlat butonuna tÄ±klayÄ±n.');
    </script>
</body>
</html>