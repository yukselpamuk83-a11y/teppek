<!DOCTYPE html>
<html>
<head>
    <title>Teppek - √áoklu √úlke Veri Y√ºkleme</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        h1 { color: #333; }
        .controls { margin: 20px 0; padding: 15px; background: #e9ecef; border-radius: 5px; }
        .country-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px; margin: 20px 0; }
        .country-card { padding: 15px; border: 2px solid #ddd; border-radius: 5px; background: white; }
        .country-card.loading { background: #fff3cd; border-color: #ffc107; }
        .country-card.success { background: #d4edda; border-color: #28a745; }
        .country-card.error { background: #f8d7da; border-color: #dc3545; }
        .stats { margin-top: 20px; padding: 15px; background: #17a2b8; color: white; border-radius: 5px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .progress { margin: 10px 0; }
        .progress-bar { height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: #28a745; transition: width 0.3s; }
        #log { max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç Teppek √áoklu √úlke Veri Y√ºkleme Sistemi</h1>
        
        <div class="stats">
            <h3>üìä Genel Durum</h3>
            <p>Toplam Y√ºklenen: <strong id="totalListings">0</strong> ilan</p>
            <p>ƒ∞≈ülenen √úlke: <strong id="processedCountries">0</strong> / <strong id="totalCountries">0</strong></p>
            <p>API √áaƒürƒ±sƒ±: <strong id="apiCalls">0</strong></p>
            <p>Durum: <span id="status">Hazƒ±r</span></p>
            <div class="progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button id="startAllBtn" onclick="startLoadingAll()">üöÄ T√ºm √úlkelerden Veri Y√ºkle</button>
            <button id="startSelectedBtn" onclick="startLoadingSelected()">üìç Se√ßili √úlkelerden Y√ºkle</button>
            <button id="stopBtn" onclick="stopLoading()" disabled>‚èπÔ∏è Durdur</button>
            <button onclick="clearLog()">üóëÔ∏è Logu Temizle</button>
        </div>
        
        <h3>√úlkeler:</h3>
        <div class="country-grid" id="countries"></div>
        
        <h3>üìã ƒ∞≈ülem Logu:</h3>
        <div id="log"></div>
    </div>

    <script>
        const countries = [
            { code: 'gb', name: 'üá¨üáß ƒ∞ngiltere', selected: true },
            { code: 'us', name: 'üá∫üá∏ Amerika', selected: true },
            { code: 'de', name: 'üá©üá™ Almanya', selected: true },
            { code: 'fr', name: 'üá´üá∑ Fransa', selected: true },
            { code: 'ca', name: 'üá®üá¶ Kanada', selected: true },
            { code: 'au', name: 'üá¶üá∫ Avustralya', selected: true },
            { code: 'nl', name: 'üá≥üá± Hollanda', selected: false },
            { code: 'it', name: 'üáÆüáπ ƒ∞talya', selected: false },
            { code: 'es', name: 'üá™üá∏ ƒ∞spanya', selected: false },
            { code: 'sg', name: 'üá∏üá¨ Singapur', selected: false },
            { code: 'nz', name: 'üá≥üáø Yeni Zelanda', selected: false },
            { code: 'za', name: 'üáøüá¶ G√ºney Afrika', selected: false },
            { code: 'at', name: 'üá¶üáπ Avusturya', selected: false },
            { code: 'br', name: 'üáßüá∑ Brezilya', selected: false },
            { code: 'mx', name: 'üá≤üáΩ Meksika', selected: false },
            { code: 'in', name: 'üáÆüá≥ Hindistan', selected: false },
            { code: 'pl', name: 'üáµüá± Polonya', selected: false },
            { code: 'be', name: 'üáßüá™ Bel√ßika', selected: false },
            { code: 'ch', name: 'üá®üá≠ ƒ∞svi√ßre', selected: false },
            { code: 'ru', name: 'üá∑üá∫ Rusya', selected: false }
        ];
        
        let totalListings = 0;
        let processedCountries = 0;
        let apiCalls = 0;
        let isRunning = false;
        
        // √úlke listesini olu≈ütur
        function createCountryCards() {
            const container = document.getElementById('countries');
            container.innerHTML = '';
            
            countries.forEach(country => {
                const card = document.createElement('div');
                card.className = 'country-card';
                card.id = `country-${country.code}`;
                card.innerHTML = `
                    <label>
                        <input type="checkbox" id="check-${country.code}" ${country.selected ? 'checked' : ''}>
                        <strong>${country.name}</strong>
                    </label>
                    <div id="${country.code}-status">Bekliyor...</div>
                    <div id="${country.code}-count">0 ilan</div>
                `;
                container.appendChild(card);
            });
            
            document.getElementById('totalCountries').textContent = countries.length;
        }
        
        // Log ekle
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#333';
            logDiv.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Logu temizle
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // ƒ∞lerleme barƒ±nƒ± g√ºncelle
        function updateProgress() {
            const progress = (processedCountries / countries.filter(c => 
                document.getElementById(`check-${c.code}`).checked
            ).length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }
        
        // Tek √ºlkeden veri y√ºkle
        async function loadCountryData(country, page = 1, maxPages = 5) {
            const card = document.getElementById(`country-${country.code}`);
            card.className = 'country-card loading';
            
            let totalFetched = 0;
            addLog(`üåç ${country.name} y√ºkleniyor...`);
            
            for (let p = 1; p <= maxPages && isRunning; p++) {
                try {
                    const response = await fetch(
                        `https://teppek.com/api/adzuna-massive-simple?country=${country.code}&page=${p}`
                    );
                    
                    apiCalls++;
                    document.getElementById('apiCalls').textContent = apiCalls;
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.success && result.listings) {
                        const fetched = result.listings.length;
                        totalFetched += fetched;
                        totalListings += fetched;
                        
                        document.getElementById(`${country.code}-count`).textContent = `${totalFetched} ilan`;
                        document.getElementById('totalListings').textContent = totalListings.toLocaleString();
                        
                        if (fetched === 0) break; // Daha fazla veri yok
                    } else {
                        throw new Error(result.error || 'Bilinmeyen hata');
                    }
                    
                    // Rate limiting i√ßin bekle
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                } catch (error) {
                    addLog(`‚ùå ${country.name} Sayfa ${p} hatasƒ±: ${error.message}`, 'error');
                    break;
                }
            }
            
            if (totalFetched > 0) {
                card.className = 'country-card success';
                document.getElementById(`${country.code}-status`).textContent = `‚úÖ Tamamlandƒ±`;
                addLog(`‚úÖ ${country.name}: ${totalFetched} ilan y√ºklendi`, 'success');
            } else {
                card.className = 'country-card error';
                document.getElementById(`${country.code}-status`).textContent = `‚ùå Hata`;
            }
            
            processedCountries++;
            document.getElementById('processedCountries').textContent = processedCountries;
            updateProgress();
        }
        
        // T√ºm √ºlkelerden y√ºkleme ba≈ülat
        async function startLoadingAll() {
            countries.forEach(c => {
                document.getElementById(`check-${c.code}`).checked = true;
            });
            startLoading();
        }
        
        // Se√ßili √ºlkelerden y√ºkleme ba≈ülat
        async function startLoadingSelected() {
            startLoading();
        }
        
        // Y√ºkleme ba≈ülat
        async function startLoading() {
            if (isRunning) return;
            
            isRunning = true;
            totalListings = 0;
            processedCountries = 0;
            apiCalls = 0;
            
            document.getElementById('startAllBtn').disabled = true;
            document.getElementById('startSelectedBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('status').textContent = '‚è≥ Y√ºkleniyor...';
            
            clearLog();
            addLog('üöÄ Veri y√ºkleme ba≈ülatƒ±ldƒ±');
            
            const selectedCountries = countries.filter(c => 
                document.getElementById(`check-${c.code}`).checked
            );
            
            if (selectedCountries.length === 0) {
                addLog('‚ö†Ô∏è L√ºtfen en az bir √ºlke se√ßin', 'error');
                stopLoading();
                return;
            }
            
            // Her √ºlkeyi sƒ±rayla y√ºkle
            for (const country of selectedCountries) {
                if (!isRunning) break;
                
                await loadCountryData(country);
                
                // √úlkeler arasƒ± bekleme
                if (selectedCountries.indexOf(country) < selectedCountries.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            document.getElementById('status').textContent = '‚úÖ Tamamlandƒ±!';
            addLog(`üéâ Toplam ${totalListings} ilan y√ºklendi`, 'success');
            stopLoading();
        }
        
        // Y√ºklemeyi durdur
        function stopLoading() {
            isRunning = false;
            document.getElementById('startAllBtn').disabled = false;
            document.getElementById('startSelectedBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
        
        // Sayfa y√ºklendiƒüinde
        createCountryCards();
        addLog('Sistem hazƒ±r. Y√ºklemek istediƒüiniz √ºlkeleri se√ßin ve ba≈ülat butonuna tƒ±klayƒ±n.');
    </script>
</body>
</html>