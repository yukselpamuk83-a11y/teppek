<!DOCTYPE html>
<html>
<head>
    <title>Teppek - Temiz API Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        h1 { color: #333; }
        .test-section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .button { padding: 12px 24px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .button.success { background: #28a745; }
        .button.error { background: #dc3545; }
        .result { margin: 15px 0; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border-left: 4px solid #17a2b8; }
        pre { white-space: pre-wrap; word-wrap: break-word; font-size: 12px; max-height: 400px; overflow-y: auto; }
        .status-bar { background: #343a40; color: white; padding: 10px; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Teppek - Temiz API Test Sistemi</h1>
        
        <div class="status-bar">
            <strong>Status:</strong> <span id="status">HazÄ±r</span> | 
            <strong>Toplam Test:</strong> <span id="testCount">0</span> | 
            <strong>BaÅŸarÄ±lÄ±:</strong> <span id="successCount">0</span> | 
            <strong>HatalÄ±:</strong> <span id="errorCount">0</span>
        </div>

        <!-- Test 1: Sistem Durumu -->
        <div class="test-section">
            <h3>ğŸ“Š Test 1: Sistem Durumu</h3>
            <p>API'nin Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± ve konfigÃ¼rasyonlarÄ± kontrol eder.</p>
            <button class="button" onclick="testSystem()">ğŸš€ Sistem Testi Ã‡alÄ±ÅŸtÄ±r</button>
            <div id="system-result"></div>
        </div>

        <!-- Test 2: Veri YÃ¼kleme -->
        <div class="test-section">
            <h3>ğŸ“¥ Test 2: Veri YÃ¼kleme</h3>
            <p>Adzuna API'sinden veri Ã§ekip PostgreSQL'e kaydeder.</p>
            <button class="button" onclick="testLoadData('gb', 1, 2)">ğŸ‡¬ğŸ‡§ Ä°ngiltere (HÄ±zlÄ±)</button>
            <button class="button" onclick="testLoadData('us,de,fr', 3, 3)">ğŸŒ Ã‡oklu Ãœlke (Normal)</button>
            <button class="button" onclick="testLoadData('gb,us,de,fr,ca', 7, 5)">ğŸš€ Tam Test (YavaÅŸ)</button>
            <div id="load-result"></div>
        </div>

        <!-- Test 3: Veri Okuma -->
        <div class="test-section">
            <h3>ğŸ“‹ Test 3: Ä°ÅŸ Ä°lanlarÄ± Okuma</h3>
            <p>PostgreSQL'den iÅŸ ilanlarÄ±nÄ± getirir ve filtreler.</p>
            <button class="button" onclick="testGetJobs()">ğŸ“‹ TÃ¼m Ä°lanlar</button>
            <button class="button" onclick="testGetJobs('q=developer')">ğŸ” Developer AramasÄ±</button>
            <button class="button" onclick="testGetJobs('country=GB')">ğŸ‡¬ğŸ‡§ Ä°ngiltere Ä°lanlarÄ±</button>
            <button class="button" onclick="testGetJobs('remote=true')">ğŸ  Remote Ä°ÅŸler</button>
            <div id="jobs-result"></div>
        </div>

        <!-- Genel SonuÃ§lar -->
        <div class="test-section">
            <h3>ğŸ“ˆ Genel SonuÃ§lar</h3>
            <button class="button" onclick="clearAll()">ğŸ—‘ï¸ TÃ¼mÃ¼nÃ¼ Temizle</button>
            <button class="button" onclick="runAllTests()">ğŸ¯ TÃ¼m Testleri Ã‡alÄ±ÅŸtÄ±r</button>
            <div id="summary-result"></div>
        </div>
    </div>

    <script>
        let testCount = 0;
        let successCount = 0;
        let errorCount = 0;

        function updateStats() {
            document.getElementById('testCount').textContent = testCount;
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('errorCount').textContent = errorCount;
        }

        function setStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function addResult(containerId, title, success, data, duration = null) {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            const durationText = duration ? ` (${duration}ms)` : '';
            
            resultDiv.className = `result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `
                <h4>${success ? 'âœ…' : 'âŒ'} ${title}${durationText}</h4>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            
            container.appendChild(resultDiv);
            container.scrollTop = container.scrollHeight;
            
            testCount++;
            if (success) successCount++;
            else errorCount++;
            updateStats();
        }

        async function testSystem() {
            setStatus('ğŸ” Sistem testi Ã§alÄ±ÅŸÄ±yor...');
            const startTime = Date.now();
            
            try {
                const response = await fetch('https://teppek.com/api/test');
                const data = await response.json();
                const duration = Date.now() - startTime;
                
                addResult('system-result', 'Sistem Durumu', data.success, data, duration);
                setStatus(data.success ? 'âœ… Sistem testi baÅŸarÄ±lÄ±' : 'âŒ Sistem testi baÅŸarÄ±sÄ±z');
            } catch (error) {
                const duration = Date.now() - startTime;
                addResult('system-result', 'Sistem Durumu', false, { error: error.message }, duration);
                setStatus('âŒ Sistem testi hatalÄ±');
            }
        }

        async function testLoadData(countries, days, pages) {
            setStatus(`ğŸ”„ Veri yÃ¼kleme baÅŸlatÄ±lÄ±yor... (${countries})`);
            const startTime = Date.now();
            
            try {
                const url = `https://teppek.com/api/load-data?countries=${countries}&days=${days}&pages=${pages}`;
                const response = await fetch(url);
                const data = await response.json();
                const duration = Date.now() - startTime;
                
                addResult('load-result', `Veri YÃ¼kleme (${countries})`, data.success, data, duration);
                setStatus(data.success ? `âœ… Veri yÃ¼kleme tamamlandÄ± (${data.summary?.total_inserted || 0} ilan)` : 'âŒ Veri yÃ¼kleme baÅŸarÄ±sÄ±z');
            } catch (error) {
                const duration = Date.now() - startTime;
                addResult('load-result', `Veri YÃ¼kleme (${countries})`, false, { error: error.message }, duration);
                setStatus('âŒ Veri yÃ¼kleme hatalÄ±');
            }
        }

        async function testGetJobs(params = '') {
            setStatus('ğŸ“‹ Ä°ÅŸ ilanlarÄ± getiriliyor...');
            const startTime = Date.now();
            
            try {
                const url = `https://teppek.com/api/get-jobs${params ? '?' + params : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                const duration = Date.now() - startTime;
                
                const title = `Ä°ÅŸ Ä°lanlarÄ±${params ? ' (' + params + ')' : ''}`;
                addResult('jobs-result', title, data.success, {
                    stats: data.stats,
                    filters: data.filters,
                    sample_jobs: data.jobs?.slice(0, 3) // Ä°lk 3 ilanÄ± gÃ¶ster
                }, duration);
                
                setStatus(data.success ? `âœ… ${data.stats?.total_jobs || 0} ilan bulundu` : 'âŒ Ä°lan getirme baÅŸarÄ±sÄ±z');
            } catch (error) {
                const duration = Date.now() - startTime;
                addResult('jobs-result', 'Ä°ÅŸ Ä°lanlarÄ±', false, { error: error.message }, duration);
                setStatus('âŒ Ä°ÅŸ ilanlarÄ± getirilemedi');
            }
        }

        async function runAllTests() {
            setStatus('ğŸ¯ TÃ¼m testler Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor...');
            
            // 1. Sistem testi
            await testSystem();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // 2. KÃ¼Ã§Ã¼k veri yÃ¼kleme testi
            await testLoadData('gb', 1, 2);
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // 3. Veri okuma testleri
            await testGetJobs();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testGetJobs('q=developer');
            
            setStatus('ğŸ‰ TÃ¼m testler tamamlandÄ±!');
            
            // Ã–zet
            const summaryData = {
                total_tests: testCount,
                successful: successCount,
                failed: errorCount,
                success_rate: `${((successCount / testCount) * 100).toFixed(1)}%`,
                completed_at: new Date().toLocaleTimeString()
            };
            
            addResult('summary-result', 'Test Ã–zeti', successCount > errorCount, summaryData);
        }

        function clearAll() {
            ['system-result', 'load-result', 'jobs-result', 'summary-result'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            testCount = 0;
            successCount = 0;
            errorCount = 0;
            updateStats();
            setStatus('HazÄ±r');
        }

        // Sayfa yÃ¼klendiÄŸinde
        setStatus('HazÄ±r - Testleri baÅŸlatmak iÃ§in butonlara tÄ±klayÄ±n');
    </script>
</body>
</html>